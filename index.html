<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Police Nexorienne</title>

  <style>
    body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;font-family:Arial;background:#070b14;color:#eaf0ff;padding:24px}
    .card{width:min(520px,92vw);border:1px solid rgba(255,255,255,.1);border-radius:18px;padding:22px;background:#0e1730;text-align:center}
    .btn{border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.06);color:#eaf0ff;padding:12px 14px;border-radius:999px;cursor:pointer;font-size:14px}
    .btn.primary{background:linear-gradient(135deg,#4da3ff,#7cf0c5);color:#07111f;font-weight:800;border-color:rgba(77,163,255,.35)}
    .muted{color:#b7c2e6;font-size:13px;line-height:1.5}
    .status{margin-top:12px;font-size:13px;color:#b7c2e6;word-break:break-word}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="card">
    <h1>Police Nexorienne</h1>
    <p class="muted">Connexion agents via Discord</p>

    <button class="btn primary" id="loginDiscord">Connexion Discord</button>

    <div class="status" id="status">Statut : prêt</div>
  </div>

  <script>
    const statusEl = document.getElementById("status");

    // 1) Mets tes vraies valeurs ici
    const SUPABASE_URL = "https://kqasldzyfixbmpnjjvyc.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtxYXNsZHp5Zml4Ym1wbmpqdnljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2Nzk2OTYsImV4cCI6MjA4NTI1NTY5Nn0.gVBcxqvYFq3cRwjWYgOZwjwGhnh5poXpEhUlnsQjKWA";

    // 2) Vérifie que la lib Supabase a bien chargé
    if (!window.supabase) {
      statusEl.textContent = "ERREUR : la librairie Supabase ne charge pas (CDN bloqué).";
      throw new Error("Supabase CDN not loaded");
    }

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    document.getElementById("loginDiscord").addEventListener("click", async () => {
      try {
        statusEl.textContent = "Redirection vers Discord...";
        const { data, error } = await supabase.auth.signInWithOAuth({
          provider: "discord",
          options: {
            redirectTo: "https://nexora-rp.github.io/police-nexorienne.github.io/"
          }
        });
        if (error) throw error;

        // Normalement tu es redirigé avant d’arriver ici
        statusEl.textContent = "OK (en attente redirection)...";
      } catch (e) {
        statusEl.textContent = "ERREUR : " + (e?.message || e);
      }
    });
  </script>
</body>
</html>
